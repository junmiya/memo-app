# 🧪 ローカルテスト手順書

## **テスト目的**
localStorage実装により、異なるユーザー間でのルーム共有が正常に動作することを確認

## **🚀 事前準備**

### **1. 開発サーバー起動**
```bash
npm run dev
```
→ http://localhost:3000 でアクセス可能になります

### **2. 2つのブラウザ環境を準備**
- **方法A**: 通常ブラウザ + シークレット/プライベートブラウザ
- **方法B**: Chrome + Firefox など異なるブラウザ
- **方法C**: 同じブラウザの異なるプロファイル

## **📋 テストシナリオ**

### **Phase 1: User1でルーム作成**

1. **ブラウザ1でログイン**
   - URL: `http://localhost:3000/login`
   - Email: `test1@example.com`
   - Password: `password123`

2. **チャットページに移動**
   - `/chat` に移動
   - 「+ 新規作成」ボタンをクリック

3. **公開ルーム作成**
   ```
   ルームタイトル: E2E Test Room [現在時刻]
   公開設定: public
   チャット形式: 1vN  
   お知らせ: This is a test public room for localStorage
   ```
   - 「ルームを作成」をクリック

4. **✅ 確認項目**
   - [ ] ルームが作成され、チャット画面に移動
   - [ ] ルームタイトルが正しく表示される
   - [ ] 「参加中のルーム」セクションに表示される

### **Phase 2: User2で確認・参加**

1. **ブラウザ2でログイン**
   - URL: `http://localhost:3000/login`
   - Email: `test2@example.com`  
   - Password: `password123`

2. **チャットページで確認**
   - `/chat` に移動
   - **重要**: ページリロードして最新データを読み込み

3. **✅ 確認項目**
   - [ ] 「参加可能な公開ルーム」セクションが表示される
   - [ ] User1が作成したルームが表示される
   - [ ] ルームタイトルが正しく表示される

4. **ルーム参加**
   - 表示されたルームの「参加」ボタンをクリック
   - [ ] ルームが「参加中のルーム」セクションに移動することを確認

### **Phase 3: メッセージ送受信テスト**

1. **User2からメッセージ送信**
   - 参加したルームをクリックしてチャット画面に移動
   - メッセージを送信: `Hello from User2! [現在時刻]`
   - [ ] メッセージが表示されることを確認

2. **User1で確認**
   - ブラウザ1に戻る
   - ページをリロード
   - [ ] User2のメッセージが表示されることを確認

3. **User1からメッセージ送信**
   - メッセージを送信: `Hello from User1! [現在時刻]`
   - [ ] メッセージが表示されることを確認

4. **User2で確認**
   - ブラウザ2に戻る
   - ページをリロード
   - [ ] User1のメッセージが表示されることを確認

## **🔍 詳細チェックポイント**

### **localStorage確認（開発者ツール）**

1. **ブラウザ開発者ツール**を開く (F12)
2. **Application** > **Local Storage** > **localhost:3000**
3. **確認する項目**:
   ```
   chat-app-mock-rooms: [ルーム情報のJSON]
   chat-app-mock-messages: [メッセージ情報のJSON]
   ```

### **期待されるlocalStorageデータ例**

**chat-app-mock-rooms**:
```json
[{
  "roomId": "作成されたルームID",
  "ownerUid": "test1@example.com",
  "title": "E2E Test Room [時刻]",
  "visibility": "public",
  "participants": ["test1@example.com", "test2@example.com"]
}]
```

**chat-app-mock-messages**:
```json
{
  "作成されたルームID": [{
    "msgId": "メッセージID",
    "senderUid": "test2@example.com",
    "text": "Hello from User2! [時刻]"
  }]
}
```

## **🐛 トラブルシューティング**

### **問題: User2でルームが表示されない**
- [ ] ページをリロード（F5）
- [ ] 開発者ツールでlocalStorageを確認
- [ ] ルームの`visibility`が`"public"`になっているか確認

### **問題: メッセージが表示されない**
- [ ] 両方のブラウザでページリロード
- [ ] localStorage内のメッセージデータを確認
- [ ] ブラウザコンソールでエラーがないか確認

### **問題: 参加ボタンが動作しない**
- [ ] ネットワークタブでAPI呼び出しを確認
- [ ] コンソールでJavaScriptエラーを確認

## **📊 テスト結果記録**

### **実行環境**
- 日時: `___________`
- ブラウザ1: `___________`
- ブラウザ2: `___________`
- Node.js バージョン: `___________`

### **テスト結果**
- [ ] ✅ User1でルーム作成成功
- [ ] ✅ User2でルーム表示成功  
- [ ] ✅ User2でルーム参加成功
- [ ] ✅ User2→User1 メッセージ送信成功
- [ ] ✅ User1→User2 メッセージ送信成功
- [ ] ✅ localStorage データ永続化確認

### **発見した問題**
```
問題: ________________________________
再現手順: ____________________________
期待結果: ____________________________
実際結果: ____________________________
```

## **🎯 成功基準**

**全て✅になれば、ルーム共有問題は完全に解決されています！**

1. User1が作成した公開ルームがUser2で表示される
2. User2がUser1のルームに参加できる  
3. 両ユーザー間でメッセージの送受信ができる
4. localStorageにデータが正しく保存・読み込みされる
5. ページリロード後もデータが保持される

---

**💡 ヒント**: 問題が発生した場合は、ブラウザ開発者ツールのConsoleとNetworkタブを確認してください。エラーメッセージが解決の手がかりになります。